import os
import requests
import json
from datetime import datetime, timedelta

API_KEY = os.environ.get('FOOTBALL_DATA_API_KEY')

# --- 1. ‡∏™‡∏°‡∏∏‡∏î‡∏à‡∏î‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡∏° (‡∏â‡∏ö‡∏±‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå 2024/25) ---
TEAM_MAPPING = {
    # ==========================================
    # üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø ‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏£‡πå‡∏•‡∏µ‡∏Å (Premier League)
    # ==========================================
    '‡πÅ‡∏°‡∏ô‡∏¢‡∏π': 66, '‡∏ú‡∏µ‡πÅ‡∏î‡∏á': 66, 'manutd': 66, 'mu': 66,
    '‡∏•‡∏¥‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏û‡∏π‡∏•': 64, '‡∏´‡∏á‡∏™‡πå': 64, 'liverpool': 64, 'lfc': 64,
    '‡∏≠‡∏≤‡∏£‡πå‡πÄ‡∏ã‡∏ô‡∏≠‡∏•': 57, '‡∏õ‡∏∑‡∏ô‡πÉ‡∏´‡∏ç‡πà': 57, 'arsenal': 57,
    '‡πÄ‡∏ä‡∏•‡∏ã‡∏µ': 61, '‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏•‡∏π': 61, 'chelsea': 61,
    '‡πÅ‡∏°‡∏ô‡∏ã‡∏¥‡∏ï‡∏µ‡πâ': 65, '‡πÄ‡∏£‡∏∑‡∏≠‡πÉ‡∏ö': 65, 'mancity': 65,
    '‡∏™‡πÄ‡∏õ‡∏≠‡∏£‡πå‡∏™': 73, '‡πÑ‡∏Å‡πà‡πÄ‡∏î‡∏∑‡∏≠‡∏¢‡∏ó‡∏≠‡∏á': 73, 'spurs': 73,
    '‡∏ô‡∏¥‡∏ß‡∏Ñ‡∏≤‡∏™‡πÄ‡∏ã‡∏¥‡∏•': 67, '‡∏™‡∏≤‡∏•‡∏¥‡∏Å‡∏≤': 67, 'newcastle': 67,
    '‡πÄ‡∏≠‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ï‡∏±‡∏ô': 62, '‡∏ó‡∏≠‡∏ü‡∏ü‡∏µ‡πà': 62, 'everton': 62,
    '‡∏ß‡∏¥‡∏•‡∏•‡πà‡∏≤': 58, '‡πÅ‡∏≠‡∏™‡∏ï‡∏±‡∏ô‡∏ß‡∏¥‡∏•‡∏•‡πà‡∏≤': 58, 'astonvilla': 58,
    '‡πÄ‡∏ß‡∏™‡∏ï‡πå‡πÅ‡∏Æ‡∏°': 563, '‡∏Ç‡∏∏‡∏ô‡∏Ñ‡πâ‡∏≠‡∏ô': 563, 'westham': 563,
    '‡πÄ‡∏•‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå': 338, '‡∏à‡∏¥‡πâ‡∏á‡∏à‡∏≠‡∏Å': 338, 'leicester': 338,
    '‡πÑ‡∏ö‡∏£‡∏ó‡πå‡∏ï‡∏±‡∏ô': 397, 'brighton': 397,
    '‡∏ß‡∏π‡∏•‡πå‡∏ü': 76, 'wolves': 76,
    '‡∏û‡∏≤‡πÄ‡∏•‡∏ã': 354, '‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡∏±‡∏•‡∏û‡∏≤‡πÄ‡∏•‡∏ã': 354, 'crystalpalace': 354,
    '‡πÄ‡∏ö‡∏£‡∏ô‡∏ó‡πå‡∏ü‡∏≠‡∏£‡πå‡∏î': 402, 'brentford': 402,
    '‡∏ü‡∏π‡πÅ‡∏•‡πà‡∏°': 63, 'fulham': 63,
    '‡∏ü‡∏≠‡πÄ‡∏£‡∏™‡∏ï‡πå': 351, 'forest': 351,
    '‡∏ö‡∏≠‡∏£‡πå‡∏ô‡∏°‡∏±‡∏ò': 1044, 'bournemouth': 1044,
    '‡πÄ‡∏ã‡∏≤‡πÅ‡∏ò‡∏°‡∏õ‡πå‡∏ï‡∏±‡∏ô': 340, 'southampton': 340,
    '‡∏≠‡∏¥‡∏õ‡∏™‡∏ß‡∏¥‡∏ä': 349, 'ipswich': 349,

    # ==========================================
    # üá™üá∏ ‡∏•‡∏≤‡∏•‡∏µ‡∏Å‡∏≤ ‡∏™‡πÄ‡∏õ‡∏ô (La Liga)
    # ==========================================
    '‡∏°‡∏≤‡∏î‡∏£‡∏¥‡∏î': 86, '‡πÄ‡∏£‡∏≠‡∏±‡∏•‡∏°‡∏≤‡∏î‡∏£‡∏¥‡∏î': 86, 'realmadrid': 86,
    '‡∏ö‡∏≤‡∏£‡πå‡∏ã‡πà‡∏≤': 81, '‡∏ö‡∏≤‡∏£‡πå‡πÄ‡∏ã‡πÇ‡∏•‡∏ô‡πà‡∏≤': 81, 'barcelona': 81,
    '‡πÅ‡∏≠‡∏ï‡∏°‡∏≤‡∏î‡∏£‡∏¥‡∏î': 78, 'atletico': 78,
    '‡πÄ‡∏ã‡∏ö‡∏µ‡∏¢‡πà‡∏≤': 559, 'sevilla': 559,
    '‡∏ö‡∏≤‡πÄ‡∏•‡∏ô‡πÄ‡∏ã‡∏µ‡∏¢': 95, 'valencia': 95,
    '‡∏ö‡∏µ‡∏¢‡∏≤‡∏£‡πå‡πÄ‡∏£‡∏≠‡∏±‡∏•': 94, 'villarreal': 94,
    '‡πÇ‡∏ã‡πÄ‡∏ã‡∏µ‡∏¢‡∏î‡∏≤‡∏î': 92, 'sociedad': 92,
    '‡∏ö‡∏¥‡∏•‡πÄ‡∏ö‡∏≤': 77, '‡πÅ‡∏≠‡∏ò‡πÄ‡∏•‡∏ï‡∏¥‡∏Å‡∏ö‡∏¥‡∏•‡πÄ‡∏ö‡∏≤': 77, 'athletic': 77, 'athleticclub': 77, # <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
    '‡πÄ‡∏≠‡∏™‡∏õ‡∏±‡∏ô‡∏ç‡πà‡∏≠‡∏•': 80, 'espanyol': 80, # <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
    '‡πÄ‡∏•‡∏Å‡∏≤‡πÄ‡∏ô‡∏™': 745, 'leganes': 745,   # <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
    '‡∏ö‡∏≤‡∏¢‡∏≤‡πÇ‡∏î‡∏•‡∏¥‡∏î': 250, 'valladolid': 250, # <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
    '‡πÄ‡∏ö‡∏ï‡∏¥‡∏™': 90, 'betis': 90,
    '‡∏à‡∏¥‡πÇ‡∏£‡∏ô‡πà‡∏≤': 298, 'girona': 298,
    '‡πÄ‡∏ã‡∏•‡∏ï‡πâ‡∏≤': 558, 'celta': 558,
    '‡∏°‡∏≤‡∏¢‡∏≠‡∏£‡πå‡∏Å‡πâ‡∏≤': 89, 'mallorca': 89,
    '‡∏£‡∏≤‡πÇ‡∏¢': 87, 'rayo': 87,
    '‡πÇ‡∏≠‡∏ã‡∏≤‡∏ã‡∏π‡∏ô‡πà‡∏≤': 79, 'osasuna': 79,
    '‡πÄ‡∏Å‡∏ï‡∏≤‡πÄ‡∏ü‡πà': 82, 'getafe': 82,
    '‡∏•‡∏≤‡∏™‡∏õ‡∏±‡∏•‡∏°‡∏≤‡∏™': 275, 'laspalmas': 275,
    '‡∏≠‡∏•‡∏≤‡πÄ‡∏ö‡∏™': 263, 'alaves': 263,

    # ==========================================
    # üá©üá™ ‡∏ö‡∏∏‡∏ô‡πÄ‡∏î‡∏™‡∏•‡∏µ‡∏Å‡∏≤ ‡πÄ‡∏¢‡∏≠‡∏£‡∏°‡∏±‡∏ô (Bundesliga)
    # ==========================================
    '‡∏ö‡∏≤‡πÄ‡∏¢‡∏¥‡∏£‡πå‡∏ô': 5, '‡πÄ‡∏™‡∏∑‡∏≠‡πÉ‡∏ï‡πâ': 5, 'bayern': 5,
    '‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏°‡∏∏‡∏ô‡∏î‡πå': 4, '‡πÄ‡∏™‡∏∑‡∏≠‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á': 4, 'dortmund': 4,
    '‡πÄ‡∏•‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏Ñ‡∏π‡πÄ‡∏ã‡πà‡∏ô': 3, '‡∏´‡πâ‡∏≤‡∏á‡∏¢‡∏≤': 3, 'leverkusen': 3,
    '‡πÑ‡∏•‡∏õ‡πå‡∏ã‡∏¥‡∏Å': 721, 'leipzig': 721,
    '‡πÅ‡∏ü‡∏£‡∏á‡∏Å‡πå‡πÄ‡∏ü‡∏¥‡∏£‡πå‡∏ï': 19, 'frankfurt': 19,
    '‡πÇ‡∏ß‡∏•‡πå‡∏ü‡∏™‡∏ö‡∏ß‡∏£‡πå‡∏Å': 11, 'wolfsburg': 11,
    '‡∏Å‡∏•‡∏±‡∏î‡∏ö‡∏±‡∏Ñ': 18, '‡∏°‡∏∂‡∏ô‡πÄ‡∏ä‡πà‡∏ô‡∏Å‡∏•‡∏±‡∏î‡∏ö‡∏±‡∏Ñ': 18, 'gladbach': 18, 'monchengladbach': 18, # <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
    '‡∏≠‡∏≠‡∏Å‡∏™‡∏ö‡∏ß‡∏£‡πå‡∏Å': 16, '‡∏≠‡∏±‡∏Ñ‡πÄ‡∏ö‡∏¥‡∏£‡πå‡∏Å': 16, 'augsburg': 16, # <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
    '‡∏ã‡∏±‡∏á‡∏ï‡πå‡πÄ‡∏û‡∏≤‡∏•‡∏µ': 35, 'stpauli': 35, 'fcstpauli': 35, # <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
    '‡πÇ‡∏Æ‡∏•‡∏™‡πÑ‡∏ï‡∏ô‡πå‡∏Ñ‡∏µ‡∏•': 720, 'holsteinkiel': 720, 'kiel': 720, # <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏ä‡πá‡∏Ñ ID ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ñ‡∏∑‡∏≠ 720 ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á)
    '‡∏™‡∏ï‡∏∏‡πä‡∏ï‡∏Å‡∏≤‡∏£‡πå‡∏ó': 10, 'stuttgart': 10,
    '‡πÑ‡∏ü‡∏£‡πå‡∏ö‡∏ß‡∏£‡πå‡∏Å': 17, 'freiburg': 17,
    '‡∏Æ‡∏≠‡∏ü‡πÄ‡∏ü‡∏ô‡πÑ‡∏Æ‡∏°‡πå': 2, 'hoffenheim': 2,
    '‡πÑ‡∏°‡∏ô‡∏ã‡πå': 15, 'mainz': 15,
    '‡∏¢‡∏π‡πÄ‡∏ô‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏•‡∏¥‡∏ô': 28, 'unionberlin': 28,
    '‡πÄ‡∏ö‡∏£‡πÄ‡∏°‡∏ô': 12, 'werder': 12,
    '‡πÇ‡∏ö‡∏Ñ‡∏∏‡πà‡∏°': 36, 'bochum': 36,
    '‡πÑ‡∏Æ‡πÄ‡∏î‡∏ô‡πÑ‡∏Æ‡∏°‡πå': 44, 'heidenheim': 44,

    # ==========================================
    # üáÆüáπ ‡∏Å‡∏±‡∏•‡πÇ‡∏ä‡πà ‡πÄ‡∏ã‡πÄ‡∏£‡∏µ‡∏¢‡∏≠‡∏≤ ‡∏≠‡∏¥‡∏ï‡∏≤‡∏•‡∏µ (Serie A)
    # ==========================================
    '‡∏¢‡∏π‡πÄ‡∏ß‡∏ô‡∏ï‡∏∏‡∏™': 109, 'juve': 109,
    '‡∏°‡∏¥‡∏•‡∏≤‡∏ô': 98, 'milan': 98,
    '‡∏≠‡∏¥‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå': 108, 'inter': 108,
    '‡πÇ‡∏£‡∏°‡πà‡∏≤': 100, 'roma': 100,
    '‡∏ô‡∏≤‡πÇ‡∏õ‡∏•‡∏µ': 113, 'napoli': 113,
    '‡∏•‡∏≤‡∏ã‡∏¥‡πÇ‡∏≠': 110, 'lazio': 110,
    '‡∏ü‡∏¥‡∏≠‡∏≠': 99, 'fiorentina': 99,
    '‡∏≠‡∏ï‡∏≤‡∏•‡∏±‡∏ô‡∏ï‡πâ‡∏≤': 102, 'atalanta': 102,
    '‡πÇ‡∏Ñ‡πÇ‡∏°': 1047, 'como': 1047, # <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
    '‡∏Å‡∏≤‡∏¢‡∏≤‡∏£‡∏µ‡πà': 104, '‡∏Ñ‡∏≤‡∏Å‡∏¥‡∏≠‡∏≤‡∏£‡∏¥': 104, 'cagliari': 104, # <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
    '‡∏õ‡∏≤‡∏£‡πå‡∏°‡πà‡∏≤': 112, 'parma': 112, # <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
    '‡πÄ‡∏≠‡πá‡∏°‡πÇ‡∏õ‡∏•‡∏µ': 445, 'empoli': 445, # <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
    '‡πÄ‡∏ß‡πÄ‡∏ô‡πÄ‡∏ã‡∏µ‡∏¢': 454, 'venezia': 454, # <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
    '‡πÇ‡∏ö‡πÇ‡∏•‡∏ç‡∏ç‡πà‡∏≤': 103, 'bologna': 103,
    '‡πÇ‡∏ï‡∏£‡∏¥‡πÇ‡∏ô‡πà': 586, 'torino': 586,
    '‡∏≠‡∏π‡∏î‡∏¥‡πÄ‡∏ô‡πÄ‡∏ã‡πà': 115, 'udinese': 115,
    '‡πÄ‡∏à‡∏ô‡∏±‡∏ß': 107, 'genoa': 107,
    '‡∏°‡∏≠‡∏ô‡∏ã‡πà‡∏≤': 5911, 'monza': 5911,
    '‡πÄ‡∏•‡∏ä‡πÄ‡∏ä‡πà': 5890, 'lecce': 5890,
    '‡πÄ‡∏ß‡πÇ‡∏£‡∏ô‡πà‡∏≤': 450, 'verona': 450,

    # ==========================================
    # üá´üá∑ ‡∏•‡∏µ‡∏Å‡πÄ‡∏≠‡∏¥‡∏á ‡∏ù‡∏£‡∏±‡πà‡∏á‡πÄ‡∏®‡∏™ (Ligue 1)
    # ==========================================
    '‡∏õ‡∏≤‡∏£‡∏µ‡∏™': 524, 'psg': 524,
    '‡∏°‡∏≤‡∏£‡πå‡∏Å‡πÄ‡∏ã‡∏¢': 523, 'marseille': 523,
    '‡∏•‡∏µ‡∏¢‡∏á': 529, 'lyon': 529,
    '‡πÇ‡∏°‡∏ô‡∏≤‡πÇ‡∏Å': 548, 'monaco': 548,
    '‡∏•‡∏µ‡∏•‡∏•‡πå': 521, 'lille': 521,
    '‡∏ï‡∏π‡∏•‡∏π‡∏™': 511, 'toulouse': 511, # <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
    '‡πÅ‡∏ö‡∏£‡∏™‡∏ï‡πå': 512, 'brest': 512,   # <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
    '‡∏≠‡∏≠‡∏á‡πÄ‡∏ã‡πà‡∏£‡πå': 532, 'angers': 532, # <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
    '‡∏•‡∏≠‡∏£‡∏¥‡∏¢‡∏≠‡∏á‡∏ï‡πå': 525, 'lorient': 525, # <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
    '‡πÄ‡∏•‡∏≠‡∏≠‡∏≤‡∏ü': 538, 'lehavre': 538, # <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
    '‡πÇ‡∏≠‡πÅ‡∏ä‡∏£‡πå': 519, 'auxerre': 519, # <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
    '‡πÄ‡∏°‡πá‡∏ï‡∏ã‡πå': 545, 'metz': 545,    # <-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß
    '‡∏•‡πá‡∏≠‡∏á‡∏™‡πå': 546, 'lens': 546,
    '‡πÅ‡∏£‡∏ô‡∏™‡πå': 550, 'rennes': 550,
    '‡∏ô‡∏µ‡∏ã': 522, 'nice': 522,
    '‡∏™‡∏ï‡∏£‡∏≤‡∏™‡∏ö‡∏π‡∏£‡πå‡∏Å': 576, 'strasbourg': 576,
    '‡πÅ‡∏£‡πá‡∏á‡∏™‡πå': 511, 'reims': 511, # (Note: Reims and Toulouse sometimes share IDs in old DBs, checking consistency: Reims=511, Toulouse=511? Wait. Official: Reims=511, Toulouse=510 usually. I will correct Toulouse to 510 to be safe, but API will confirm)
    '‡∏ô‡πá‡∏≠‡∏á‡∏ï‡πå': 543, 'nantes': 543,
    '‡∏°‡∏á‡∏ï‡πå‡πÄ‡∏õ‡∏•‡∏•‡∏¥‡πÄ‡∏¢‡πà‡∏£‡πå': 518, 'montpellier': 518
}

# (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏π‡∏•‡∏π‡∏™‡πÄ‡∏õ‡πá‡∏ô 510 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏ß‡∏£‡πå ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ Search ‡∏ñ‡πâ‡∏≤ API ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)
TEAM_MAPPING['‡∏ï‡∏π‡∏•‡∏π‡∏™'] = 510
TEAM_MAPPING['toulouse'] = 510

def get_live_scores(days_offset=0):
    # ... (‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏´‡∏≤‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö) ...
    url = "https://api.football-data.org/v4/matches"
    headers = {'X-Auth-Token': API_KEY}
    target_date = datetime.now() + timedelta(days=days_offset)
    date_str = target_date.strftime('%Y-%m-%d')
    
    params = {
        'status': 'FINISHED,LIVE,PAUSED,SCHEDULED',
        'dateFrom': date_str,
        'dateTo': date_str
    }
    
    try:
        response = requests.get(url, headers=headers, params=params)
        if response.status_code == 200:
            data = response.json()
            matches = data.get('matches', [])
            if not matches:
                return f"‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà {date_str} ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡πÉ‡∏ô‡∏•‡∏µ‡∏Å‡∏´‡∏•‡∏±‡∏Å‡πÜ ‡∏Ñ‡∏£‡∏±‡∏ö"
            
            if days_offset == 0: title = "‚öΩ ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°/‡∏ú‡∏•‡∏ö‡∏≠‡∏• **‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ** ‚öΩ"
            elif days_offset == -1: title = f"‚öΩ ‡∏ú‡∏•‡∏ö‡∏≠‡∏• **‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô** ({date_str}) ‚öΩ"
            elif days_offset == 1: title = f"‚öΩ ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ö‡∏≠‡∏• **‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ** ({date_str}) ‚öΩ"
            else: title = f"‚öΩ ‡∏ú‡∏•‡∏ö‡∏≠‡∏•‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà {date_str} ‚öΩ"

            reply_msg = f"{title}\n\n"
            target_leagues = ['PL', 'PD', 'CL', 'BL1', 'SA', 'FL1'] # ‡πÄ‡∏û‡∏¥‡πà‡∏° FL1 (‡∏•‡∏µ‡∏Å‡πÄ‡∏≠‡∏¥‡∏á)
            
            found_match = False
            for match in matches:
                league_code = match['competition']['code']
                if league_code in target_leagues:
                    found_match = True
                    time_str = match['utcDate'][11:16]
                    home = match['homeTeam']['shortName']
                    away = match['awayTeam']['shortName']
                    status = match['status']
                    
                    if status in ['FINISHED', 'LIVE', 'PAUSED']:
                        score_home = match['score']['fullTime']['home']
                        score_away = match['score']['fullTime']['away']
                        if score_home is None: score_home = 0
                        if score_away is None: score_away = 0
                        reply_msg += f"‚è∞ {time_str} : {home} {score_home}-{score_away} {away} ({status})\n"
                    else:
                        reply_msg += f"‚è∞ {time_str} : {home} vs {away}\n"
            
            if not found_match: return f"‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà {date_str} ‡∏°‡∏µ‡πÄ‡∏ï‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏µ‡∏Å‡∏£‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏î‡∏∂‡∏á‡∏°‡∏≤‡πÇ‡∏ä‡∏ß‡πå"
            return reply_msg
        else:
            return f"‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ (Code: {response.status_code})"
    except Exception as e:
        return f"‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: {e}"

def get_last_5_matches(team_name):
    team_id = TEAM_MAPPING.get(team_name.lower())
    if not team_id: return f"‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ó‡∏µ‡∏° '{team_name}' ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏£‡∏±‡∏ö"

    url = f"https://api.football-data.org/v4/teams/{team_id}/matches"
    headers = {'X-Auth-Token': API_KEY}
    params = {'status': 'FINISHED', 'limit': 50}

    try:
        response = requests.get(url, headers=headers, params=params)
        matches = response.json().get('matches', [])
        if not matches: return "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏£‡∏±‡∏ö"
        
        last_5 = matches[::-1][:5]
        reply_msg = f"üìä **‡∏ú‡∏• 5 ‡∏ô‡∏±‡∏î‡∏´‡∏•‡∏±‡∏á‡∏™‡∏∏‡∏î: {team_name}** üìä\n\n"
        
        for match in last_5:
            date_str = match['utcDate'][0:10]
            home = match['homeTeam']['shortName']
            away = match['awayTeam']['shortName']
            score_h = match['score']['fullTime']['home']
            score_a = match['score']['fullTime']['away']
            
            # ‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏ú‡∏•
            is_home = (match['homeTeam']['id'] == team_id)
            my_score = score_h if is_home else score_a
            opp_score = score_a if is_home else score_h
            
            if my_score > opp_score: icon = "‚úÖ"
            elif my_score < opp_score: icon = "‚ùå"
            else: icon = "‚ûñ"
            
            reply_msg += f"{icon} {date_str}: {home} {score_h}-{score_a} {away}\n"
        return reply_msg
    except Exception as e: return f"Error: {e}"

# --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà: ‡∏î‡∏∂‡∏á 3 ‡∏ô‡∏±‡∏î‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤ ---
def get_upcoming_matches(team_name):
    team_id = TEAM_MAPPING.get(team_name.lower())
    if not team_id: return f"‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ó‡∏µ‡∏° '{team_name}' ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏£‡∏±‡∏ö"

    url = f"https://api.football-data.org/v4/teams/{team_id}/matches"
    headers = {'X-Auth-Token': API_KEY}
    params = {
        'status': 'SCHEDULED', # ‡πÄ‡∏≠‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ï‡∏∞
        'limit': 10 # ‡∏î‡∏∂‡∏á‡∏°‡∏≤‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÜ
    }

    try:
        response = requests.get(url, headers=headers, params=params)
        matches = response.json().get('matches', [])
        if not matches: return "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÅ‡∏Ç‡πà‡∏á‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö"
        
        # ‡πÄ‡∏≠‡∏≤‡πÅ‡∏Ñ‡πà 3 ‡∏ô‡∏±‡∏î‡πÅ‡∏£‡∏Å
        next_3 = matches[:3]
        
        reply_msg = f"üìÖ **‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° 3 ‡∏ô‡∏±‡∏î‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: {team_name}** üìÖ\n\n"
        
        for match in next_3:
            date_str = match['utcDate'][0:10]
            time_str = match['utcDate'][11:16]
            home = match['homeTeam']['shortName']
            away = match['awayTeam']['shortName']
            competition = match['competition']['name']
            
            reply_msg += f"üóì {date_str} {time_str}\n‚öΩ {home} vs {away}\nüèÜ {competition}\n\n"
            
        return reply_msg
    except Exception as e: return f"Error: {e}"